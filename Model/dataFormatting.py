import os
import pandas as pd
    
# Get C files 
def get_c_files_from_text(vulnerable_path, non_vulnerable_path):
    files_list = []
    file_label = []
    
    # For vulnerable files
    if os.path.isdir(vulnerable_path):
        for root, dirs, files in os.walk(vulnerable_path):
            for file in files:
                if file.endswith('.c'):
                    temp_file_data = []
                    with open(os.path.join(root, file), encoding='latin1') as f:                        
                        lines = f.readlines()
                        files_list.append(lines)
                        file_label.append(1)


    if os.path.isdir(non_vulnerable_path):
        for root, dirs, files in os.walk(non_vulnerable_path):
            for file in files:
                if file.endswith('.c'):
                    temp_file_data = []
                    with open(os.path.join(root, file), encoding='latin1') as f:                        
                        lines = f.readlines()
                        files_list.append(lines)
                        file_label.append(0)                                           

    return files_list, file_label

if __name__ == "__main__":
    # Dictionary to store characters and their corresponding replacements
    non_vulnerable_path = r'LibPNG\Non_vulnerable_functions'  
    vulnerable_path = r'LibPNG\Vulnerable_functions'

    data, file_label = get_c_files_from_text(vulnerable_path,non_vulnerable_path)
    dataFrame = pd.DataFrame({"Source Code":data, "Label":file_label})
    dataFrame = dataFrame.sample(frac=1)
    dataFrame.to_pickle("Model/dataset.pickle",protocol=4)
    
